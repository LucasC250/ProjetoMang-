<app-toolbar></app-toolbar>

<div class="p-4 flex justify-content-center">
  <p-card
    [header]="mangaTitle || 'Capítulos'"
    class="w-full md:w-10 lg:w-8"
    [style]="{ border: '2px solid var(--surface-600)', 'border-radius': '0.5rem' }"
  >

    <!-- BADGE DE IDIOMA SIMPLES -->
    <div *ngIf="chapters.length > 0 && !loading" class="mb-4 text-center">
      <div class="flex justify-content-center gap-2 mb-2">
        <span
          *ngIf="hasPortugueseChapters"
          class="px-3 py-1 border-round text-sm font-bold"
          style="background-color: var(--green-100); color: var(--green-800);"
        >
          <i class="pi pi-check mr-1"></i> Português
        </span>
        <span
          *ngIf="hasEnglishChapters"
          class="px-3 py-1 border-round text-sm font-bold"
          style="background-color: var(--blue-100); color: var(--blue-800);"
        >
          <i class="pi pi-language mr-1"></i> Inglês
        </span>
      </div>
      <p class="text-color-secondary mt-2 mb-0">
        Total de {{ chapters.length }} capítulo(s)
      </p>
    </div>

    <!-- LOADING -->
    <div *ngIf="loading" class="text-center p-6">
      <p-progressSpinner></p-progressSpinner>
      <p class="mt-3 text-color-secondary">
        {{ hasPortugueseChapters ? 'Buscando mais capítulos...' : 'Carregando capítulos...' }}
      </p>
    </div>

    <!-- ERRO -->
    <div *ngIf="error && !loading" class="text-center p-6">
      <i class="pi pi-exclamation-triangle text-4xl text-red-500 mb-3"></i>
      <p class="text-xl font-bold text-red-500 mb-2">Erro ao carregar</p>
      <p class="text-color-secondary mb-4">
        Não foi possível carregar os capítulos. Verifique sua conexão.
      </p>
      <p-button
        label="Tentar Novamente"
        icon="pi pi-refresh"
        (click)="retryLoad()"
        class="mt-3"
      ></p-button>
    </div>

    <!-- LISTA DE CAPÍTULOS -->
    <div *ngIf="!loading && !error && chapters.length > 0">
      <div
        *ngFor="let cap of chapters"
        class="flex justify-content-between align-items-center p-3 mb-2 border-round surface-50 hover:surface-100 transition-colors cursor-pointer"
        (click)="lerCapitulo(cap)"
      >
        <div class="flex-1">
          <div class="flex align-items-center gap-2 mb-1">
            <strong class="text-lg">Capítulo {{ cap.chapter }}</strong>
            <span
              class="text-xs px-2 py-1 border-round"
              [ngClass]="{
                'bg-green-100 text-green-800': cap.language.includes('pt'),
                'bg-blue-100 text-blue-800': cap.language === 'en'
              }"
            >
              {{ cap.language === 'en' ? 'EN' : 'PT' }}
              <span *ngIf="cap.note"> {{ cap.note }}</span>
            </span>
          </div>

          <p class="m-0 text-sm text-color-secondary mb-2">
            {{ cap.title }}
          </p>

          <div class="flex gap-3">
            <span *ngIf="cap.publishAt" class="text-xs text-color-secondary">
              <i class="pi pi-calendar"></i> {{ formatDate(cap.publishAt) }}
            </span>
            <span class="text-xs text-color-secondary">
              <i class="pi pi-users"></i> {{ cap.scanlationGroup }}
            </span>
            <span *ngIf="cap.volume" class="text-xs text-color-secondary">
              <i class="pi pi-book"></i> Vol. {{ cap.volume }}
            </span>
            <span class="text-xs text-color-secondary">
              <i class="pi pi-file"></i>
              {{ cap.pages > 0 ? cap.pages + ' páginas' : 'Páginas não informadas' }}
            </span>
          </div>
        </div>

        <div class="flex align-items-center gap-2">
          <p-button
            icon="pi pi-book"
            label="Ler"
            styleClass="p-button-sm p-button-primary"
          ></p-button>
        </div>
      </div>
    </div>

    <!-- SEM CAPÍTULOS -->
    <div *ngIf="!loading && !error && chapters.length === 0" class="text-center p-6">
      <i class="pi pi-book text-4xl text-color-secondary mb-3"></i>
      <p class="text-xl font-bold mb-2">Nenhum capítulo encontrado</p>
      <p class="text-color-secondary mb-4">
        Este mangá pode não ter capítulos disponíveis no momento.
      </p>

      <div class="flex flex-column gap-3 mt-4">
        <p-button
          label="Buscar em inglês"
          icon="pi pi-language"
          (click)="forceEnglishSearch()"
          styleClass="p-button-outlined"
          *ngIf="!hasPortugueseChapters"
        ></p-button>

        <p-button
          label="Tentar novamente"
          icon="pi pi-refresh"
          (click)="retryLoad()"
          styleClass="p-button-secondary"
        ></p-button>

        <p-button
          label="Voltar para lista"
          icon="pi pi-arrow-left"
          routerLink="/"
          styleClass="p-button-text"
        ></p-button>
      </div>
    </div>

  </p-card>
</div>
