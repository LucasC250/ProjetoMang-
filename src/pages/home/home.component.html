<style>
  .toolbar-bg {
    background-color: var(--yellow-400) !important;
  }

  .logo-fixed {
    position: absolute;
    left: 2rem;
    top: -2.5rem;
    max-height: 12rem;
    width: auto;
  }

  .spinner {
    display: inline-block;
    width: 40px;
    height: 40px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #3498db;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }
</style>

<app-toolbar></app-toolbar>

<div class="overflow-hidden">
  <div
    class="bg-center bg-no-repeat border-round h-20rem w-full"
    [style.background-image]="'url(' + currentImage + ')'"
    [style.background-size]="'cover'"
    [style]="{ border: '2px solid var(--surface-600)', 'border-radius': '0.5rem' }"
  ></div>
</div>

<br />

<div class="flex w-full h-screen gap-4 p-4">
  <div class="flex flex-column flex-grow-1 gap-4">
    <p-card class="border-round flex-grow-1 p-4">

      <!-- LOADING -->
      <div *ngIf="loading" class="text-center p-6">
        <div class="spinner mx-auto"></div>
        <p class="mt-3 text-color-secondary">
          Carregando mangás da MangaDex...
        </p>
      </div>

      <!-- GRID DE MANGÁS -->
      <div *ngIf="!loading && mangas.length > 0" class="grid">
        <div
          *ngFor="let manga of mangas; let i = index"
          class="col-12 sm:col-6 md:col-4 lg:col-3 mb-4"
        >
          <p-card class="h-full hover:shadow-4 transition-shadow cursor-pointer">

            <!-- IMAGEM -->
            <div
              class="mb-3"
              style="height: 200px; overflow: hidden; border-radius: 8px"
            >
              <img
                [src]="manga.image"
                [alt]="manga.title"
                style="width: 100%; height: 100%; object-fit: cover"
                (error)="manga.image = 'assets/images/default-manga.jpg'"
                class="hover:scale-105 transition-transform transition-duration-300"
              />
            </div>

            <!-- CONTEÚDO -->
            <h3 class="mt-0 mb-2 text-lg font-bold">
              {{ manga.title }}
            </h3>

            <div
              class="flex justify-content-between text-sm text-color-secondary mb-2"
            >
              <span class="truncate">{{ manga.author }}</span>
              <span class="flex-shrink-0">
                <i class="pi pi-star-fill text-yellow-500 mr-1"></i>
                {{ getScore(manga) }}
              </span>
            </div>

            <div class="flex justify-content-between align-items-center">
              <p-button
                (click)="lerManga(manga)"
                label="Ler"
                icon="pi pi-book"
                styleClass="p-button-sm"
              ></p-button>

              <span class="text-sm text-color-secondary">
                {{ manga.chapters }} caps
              </span>
            </div>
          </p-card>
        </div>
      </div>

      <!-- PAGINATOR (ADICIONADO) -->
      <div
        style="padding-bottom: 5rem;"
        *ngIf="!loading"
        class="flex justify-content-center mt-4"
      >
        <p-paginator
          [rows]="limit"
          [totalRecords]="totalRecords"
          [first]="page * limit"
          (onPageChange)="onPageChange($event)"
        >
        </p-paginator>
      </div>

    </p-card>
  </div>

  <!-- SIDEBAR -->
  <p-card header="Mais Populares" class="border-round w-64">
    <div class="p-3">
      <ul class="list-none p-0 m-0">
        <li
          *ngFor="let manga of mangas.slice(0, 8)"
          class="mb-3 p-2 border-round bg-gray-50 hover:bg-gray-100 cursor-pointer transition-colors"
        >
          <div class="flex align-items-center gap-3">
            <div
              style="
                width: 45px;
                height: 65px;
                overflow: hidden;
                border-radius: 4px;
                flex-shrink: 0;
              "
            >
              <img
                [src]="manga.image"
                [alt]="manga.title"
                style="width: 100%; height: 100%; object-fit: cover"
              />
            </div>

            <div class="flex-grow-1">
              <p
                class="m-0 text-sm font-bold truncate"
                style="max-width: 150px"
              >
                {{ manga.title }}
              </p>

              <div class="flex justify-content-between mt-1">
                <span class="text-xs text-color-secondary">
                  <i class="pi pi-star-fill text-yellow-500 mr-1"></i>
                  {{ getScore(manga) }}
                </span>
                <span class="text-xs text-color-secondary">
                  {{ manga.chapters }} caps
                </span>
              </div>
            </div>
          </div>
        </li>
      </ul>
    </div>
  </p-card>
</div>
